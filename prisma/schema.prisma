generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// ---------------------------------------------------------------------------
// HISTORY tables — append-only INSERT for every reading
// ---------------------------------------------------------------------------

model MeterReading {
  id             String   @id @default(uuid()) @map("id") @db.Uuid
  meterId        String   @map("meter_id") @db.VarChar(100)
  kwhConsumedAc  Float    @default(0) @map("kwh_consumed_ac")
  voltage        Float    @default(0) @map("voltage")
  ts             DateTime @default(now()) @map("ts") @db.Timestamptz()

  @@index([meterId, ts])
  @@map("meter_readings")
}

model VehicleReading {
  id             String   @id @default(uuid()) @map("id") @db.Uuid
  vehicleId      String   @map("vehicle_id") @db.VarChar(100)
  soc            Float    @default(0) @map("soc")
  kwhDeliveredDc Float    @default(0) @map("kwh_delivered_dc")
  batteryTemp    Float    @default(0) @map("battery_temp")
  ts             DateTime @default(now()) @map("ts") @db.Timestamptz()

  @@index([vehicleId, ts])
  @@map("vehicle_readings")
}

// ---------------------------------------------------------------------------
// CURRENT tables — UPSERT (one row per meter / vehicle = latest state)
// ---------------------------------------------------------------------------

model MeterCurrent {
  meterId        String   @id @map("meter_id") @db.VarChar(100)
  kwhConsumedAc  Float    @default(0) @map("kwh_consumed_ac")
  voltage        Float    @default(0) @map("voltage")
  ts             DateTime @default(now()) @map("ts") @db.Timestamptz()

  @@map("meter_current")
}

model VehicleCurrent {
  vehicleId      String   @id @map("vehicle_id") @db.VarChar(100)
  soc            Float    @default(0) @map("soc")
  kwhDeliveredDc Float    @default(0) @map("kwh_delivered_dc")
  batteryTemp    Float    @default(0) @map("battery_temp")
  ts             DateTime @default(now()) @map("ts") @db.Timestamptz()

  @@map("vehicle_current")
}

// ---------------------------------------------------------------------------
// MAPPING — which vehicle is connected to which meter
// ---------------------------------------------------------------------------

model VehicleMeterMap {
  vehicleId String   @id @map("vehicle_id") @db.VarChar(100)
  meterId   String   @map("meter_id") @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()

  @@map("vehicle_meter_map")
}
